version: '3.8'

services:
  samba:
    image: dperson/samba:latest
    environment:
      - USER=testuser;testpass
      - SHARE=testshare;/mnt/testshare;yes;no;no;testuser
      - SMB=true
      - NMBD=true
    ports:
      - "445:445"
      - "137-139:137-139"
    volumes:
      - smb_data:/mnt/testshare
    healthcheck:
      test: ["CMD", "smbclient", "-L", "localhost", "-U", "testuser%testpass"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

volumes:
  smb_data: